# GraphIQ 코드 검토 — UX 디자이너 관점

> Streamlit + FastAPI + Python 기반 주주 네트워크 자연어 질의 서비스  
> 검토 기준: 사용자 흐름, 정보 구조, 피드백·상태, 신뢰·투명성, 접근성, 일관성

---

## 1. 잘된 점 (Strengths)

### 1.1 출처·신뢰도 표시 (SOURCE_META)
- **DB / DB_EMPTY / LLM** 3단계로 답변 출처를 구분해 **환각 리스크**를 사용자에게 노출함 → 투명성·신뢰 확보에 유리
- 이모지(🟢🟡🔴) + 짧은 라벨 + 설명 문구로 한눈에 구분 가능

### 1.2 대화형 + 예시 질문
- 채팅 UI + 사이드바 예시 질문 5개로 **진입 장벽**을 낮춤
- `st.session_state.pending`으로 예시 클릭 시 입력창 대신 바로 질의 실행 → 클릭 수 감소

### 1.3 상세 정보 접기 (Expander)
- Cypher 쿼리·원본 결과를 expander로 숨겨 **기본 뷰는 단순**, 필요 시에만 깊게 탐색 가능
- 고급 사용자와 일반 사용자 모두 수용

### 1.4 API 설계
- `POST /chat`, `DELETE /chat`, `GET /health`, `GET /stats`, `GET /search` 등 역할이 명확하고 RESTful에 가깝게 구성됨

---

## 2. 개선이 필요한 부분 (UX 관점)

### 2.1 **첫 화면·빈 상태 (Empty State)**

**현재:**  
- 메시지가 없을 때 채팅 영역이 비어 있고, placeholder만 있음.

**제안:**
- **온보딩 블록** 추가:  
  "예: '삼성전자 최대주주 누구야?', '지분율 50% 이상인 주주 목록'"  
  또는 서비스 한 줄 설명 + 예시 1~2개를 카드/버튼으로 노출.
- `st.session_state.messages == []`일 때만 이 블록을 보여주고, 첫 메시지 후에는 숨기기.

```python
# graphiq_ui.py 메인 영역 상단 예시
if not st.session_state.messages:
    st.info("💡 주주, 지분율, 임원보수 등을 자연어로 질문해 보세요. 아래 예시를 눌러 시작할 수 있습니다.")
```

---

### 2.2 **로딩·처리 중 피드백**

**현재:**  
- `st.spinner("그래프 DB 탐색 중...")` 만 있음.  
- 5~30초 걸릴 수 있는데, **진행 단계**(예: “회사명 검색 중 → Cypher 생성 중 → DB 조회 중”)가 없어 체감 대기 시간이 김.

**제안:**
- API에서 **단계별 이벤트**를 지원할 수 있다면(예: SSE/WebSocket) 단계별 메시지 표시.
- 불가능하면 spinner 문구를 2~3개 로테이션:  
  "회사명 유사도 검색 중..." → "Cypher 생성 중..." → "Neo4j에서 조회 중..."  
  (클라이언트에서 일정 간격으로 문구만 바꿔도 체감 개선)

---

### 2.3 **에러 메시지 사용자 친화화**

**현재:**
- `httpx.ConnectError` → "FastAPI 서버 연결 실패. STEP 10 실행 여부를 확인하세요."  
  → **STEP 10**은 개발자/Colab 용어라 일반 사용자에게는 어색함.
- `Exception as e` → `f"❌ 오류: {e}"`  
  → 스택트레이스나 내부 코드가 노출될 수 있음.

**제안:**
- 사용자용 메시지와 개발자용 메시지 분리.  
  - 사용자: "서버에 연결할 수 없습니다. 잠시 후 다시 시도하거나, 관리자에게 문의해 주세요."  
  - 개발자: `st.expander("기술 상세")` 안에만 `str(e)` 또는 로그 노출.
- 400/503 등 HTTP 상태에 따라 다른 문구와 다음 액션(재시도, 새로고침) 안내.

---

### 2.4 **정보 우선순위·시각적 위계**

**현재:**  
- 답변 본문 → caption(출처 배지) → expander(Cypher) → caption(힌트) → caption(시간) 순서.  
- **핵심 답변**과 **부가 정보**(Cypher, raw JSON, 힌트, 시간)가 같은 비중처럼 보일 수 있음.

**제안:**
- **답변 텍스트**를 가장 크게/강조(폰트 크기·굵기).
- 출처 배지는 유지하되, **한 줄**로 압축(이모지 + "DB 직접 조회" 수준).
- Cypher/원본결과는 항상 expander(접혀 있는 상태)로 두고, 라벨을  
  "🔍 생성된 Cypher (고급)"  
  "📋 원본 데이터 (고급)"  
  처럼 “고급”을 붙여 클릭을 유도하지 않아도 됨을 암시.
- **처리 시간**은 배지 옆이나 푸터처럼 보조 정보로만 표시.

---

### 2.5 **사이드바 DB 현황**

**현재:**  
- "DB 현황 새로고침" 버튼을 눌러야만 노드 수 등이 갱신됨.  
- 첫 방문자에게는 **현재 DB가 얼마나 채워져 있는지**가 바로 안 보임 → 신뢰·기대 설정에 불리.

**제안:**
- **페이지 로드 시 1회** `GET /stats` 호출해 사이드바 상단에 노드/관계 수를 기본 표시.
- 버튼은 "새로고침"으로 두어 수동 갱신은 유지.
- 숫자가 0이거나 매우 작을 때: "데이터가 아직 적습니다. 일부 질문은 결과가 없을 수 있습니다." 같은 짧은 안내.

---

### 2.6 **채팅 입력·예시와의 일관성**

**현재:**  
- 예시 버튼 클릭 시 `st.session_state.pending`에 넣고, `st.chat_input()` or `st.session_state.pop("pending", None)` 로 처리.  
- 예시를 누르면 **입력창에 글자가 채워지지 않고** 곧바로 전송되는데, 사용자에 따라 "내가 뭘 보냈는지 확인하고 싶다"는 기대가 있을 수 있음.

**제안:**
- (A) 예시 클릭 시 **입력창 placeholder나 실제 입력창에 예시 문장 채우기** → 사용자가 수정 후 전송 가능하게.  
- (B) 현재처럼 즉시 전송하되, **전송 직전에 토스트/캡션**으로 "질문: [예시 문장]"을 1초간 보여주기.  
- (A)가 “통제감” 측면에서 더 나은 경우가 많음.

---

### 2.7 **접근성 (a11y)**

**현재:**  
- 색상만으로 DB/DB_EMPTY/LLM 구분(🟢🟡🔴).  
- 시각 장애 사용자나 색맹 사용자에게는 의미 전달이 불완전할 수 있음.

**제안:**
- 배지에 **텍스트 라벨 필수**: "DB 직접 조회", "DB 조회 결과 없음", "LLM 추론" 등.  
  (이미 있으므로 유지하고, 이모지를 제거해도 됨 — 또는 이모지 옆에 항상 라벨 표기.)
- `aria-label` 또는 Streamlit에서 제공하는 라벨/캡션을 활용.
- 다크 테마 대비: `#00ff88` 대비가 충분한지 확인(WCAG AA 이상 권장).

---

### 2.8 **모바일·좁은 뷰포트**

**현재:**  
- `layout="wide"`, `initial_sidebar_state="expanded"` → 데스크톱 중심.

**제안:**
- 좁은 화면에서는 사이드바를 **기본 접기**(`collapsed`)로 두어 메인 채팅 영역을 넓게.
- 예시 질문을 메인 상단의 **가로 스크롤 칩/버튼**으로도 제공하면, 모바일에서 사이드바를 열지 않아도 진입 가능.

---

### 2.9 **대화 초기화 확인**

**현재:**  
- "대화 초기화" 클릭 시 확인 없이 즉시 `st.session_state.messages = []` + API `DELETE /chat` 호출.

**제안:**  
- `st.dialog` 또는 `st.popover`로 "대화 이력을 모두 지울까요?" 확인 후 진행.  
- 실수로 지우는 경우를 줄일 수 있음.

---

### 2.10 **FastAPI 예외 메시지**

**현재:**  
- `HTTPException(400, "질문이 비어 있습니다.")`  
- `HTTPException(503, str(e))`  
  → 503에 `str(e)`는 내부 오류 메시지가 그대로 노출될 수 있음.

**제안:**  
- 400: 메시지 유지해도 무방.  
- 503: 사용자용 메시지는 "일시적으로 서비스를 사용할 수 없습니다. 잠시 후 다시 시도해 주세요." 로 고정하고, 상세 오류는 로그에만 남기기.

---

## 3. 정리: 우선 적용 권장 순서

| 순서 | 항목 | 효과 | 난이도 |
|------|------|------|--------|
| 1 | 빈 상태 온보딩 문구 + 예시 강조 | 첫 사용 전환·이해도 ↑ | 낮음 |
| 2 | 에러 메시지 사용자 문구로 변경 (STEP 10 등 제거) | 신뢰·프로다움 ↑ | 낮음 |
| 3 | 페이지 로드 시 DB 현황 1회 표시 | 신뢰·기대 설정 ↑ | 낮음 |
| 4 | 대화 초기화 확인 단계 | 실수 방지 ↑ | 낮음 |
| 5 | 답변 vs 부가정보 시각적 위계 (폰트·expander 라벨) | 가독성·집중도 ↑ | 중간 |
| 6 | 로딩 문구 로테이션 또는 단계 표시 | 체감 대기 시간 ↓ | 중간 |
| 7 | 예시 클릭 시 입력창에 채우기 (선택) | 통제감·명확성 ↑ | 중간 |
| 8 | 모바일 시 사이드바 접기·예시 칩 | 모바일 UX ↑ | 중간 |

---

## 4. 코드 레벨 요약

- **아키텍처(Streamlit ↔ FastAPI ↔ Neo4j)** 와 **출처/신뢰도 노출 방식**은 서비스 특성에 잘 맞고, UX 기반이 잘 잡혀 있음.
- **첫 화면, 로딩, 에러, 정보 위계, 사이드바 기본 정보, 확인 다이얼로그**만 정리해도 체감 품질이 크게 좋아질 수 있음.
- 위 항목부터 짧은 스프린트로 나눠 적용한 뒤, 실제 사용자 2~3명으로 한 번씩 흐름 테스트해 보는 것을 권장함.
