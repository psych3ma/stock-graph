# CTO 검토: 라벨 좌표(y=512) 및 개발 관행 테이블 대응

**대상 스니펫**: `<text x="100" y="512" ...>삼성생명</text>` — 원은 `cx="100" cy="100"`, 라벨만 화면 하단(512)에 붕 떠 있음.

---

## 1. 현상 원인

- **512는 하드코딩이 아님.** `adjustedY = Math.min(ay, svgH - 20)` 에서 **캔버스 하단 캡**(예: svgH=532 → 512)에 걸린 값.
- **ay**는 “겹침 회피” 루프에서 세로로 계속 밀려 올라간 결과. 순서상 뒤쪽 라벨일수록 아래로 쌓이다 보니, 일부 라벨이 **노드(cy=100)와 멀리 떨어진 y=512 근처**까지 밀림.
- 따라서 **위치 업데이트 불가**가 아니라, **알고리즘 결과로 인한 “라벨–노드 분리”**에 해당.

---

## 2. 첨부 테이블(문제–영향) 대응 현황

| 문제 | 영향 | 본 프로젝트 상태 | 조치 |
|------|------|------------------|------|
| **하드코딩 좌표** | 위치 업데이트 불가 | **해당 아님** — cx/cy/x/y는 `positions`, `labelInfo.adjustedX/adjustedY` 등 **계산값**. 다만 adjustedY가 과도히 커져 노드와 분리됨. | 라벨 Y에 **노드 기준 상한** 적용: `adjustedY ≤ label.y + maxLabelDropFromNode`(기본 120px). 노드에서 최대 120px 아래까지만 밀리도록 해 “붕 뜸” 완화. |
| **하드코딩 스타일** | 디자인 변경 시 코드 수정 필수 | **일부** — 색/간격은 `LABEL_CONFIG`, `getThemeColor`, CSS 변수로 분리. 픽셀 값(예: 16, 18)은 상수로만 두고 있음. | Config/상수로 유지, 필요 시 `force_config.js` 등으로 이전 검토. |
| **매직 넘버** | “왜 y=512인지 알 수 없음” | **512 자체는 매직 넘버가 아님** — `svgH - 20` 의 결과. 다만 “왜 라벨이 노드와 그렇게 멀리 떨어지나?”에 대한 **의미**가 코드에 없었음. | `maxLabelDropFromNode` 상수 도입 + 주석으로 “노드에서 최대 Npx 아래까지만” 명시. 512 같은 값이 나오지 않도록 상한 적용. |
| **접근성 부재** | 스크린 리더 미지원 | **미적용** — SVG `<text>`에 `aria-label`/역할 없음. | 별도 이슈. 노드 그룹/라벨에 `role="img"` `aria-label="노드명: 삼성생명"` 등 추가 검토. |
| **테스트 불가** | 시각화 검증 어려움 | **부분** — 좌표는 런타임 계산이라 단위 테스트로 “특정 y” 검증은 어렵고, 시각 회귀는 수동/스크린샷. | 상한 도입으로 “라벨이 viewport 하단을 넘어가지 않음” “노드에서 Npx 이내” 등 **조건**은 테스트 가능. |
| **협업 불가능** | 팀별 부분 수정 불가 | **완화됨** — 설정(Config), 레이아웃, 렌더, API가 어느 정도 분리. | 유지. 설정/상수 추가로 “숫자만 바꾸는” 협업은 더 수월해짐. |

---

## 3. 적용한 코드 변경

- **`LABEL_CONFIG.maxLabelDropFromNode`**: 120 (기본). 겹침 회피로 라벨을 밀 때, **노드 기준 자연 위치(`label.y`)에서 최대 120px 아래까지만** 허용.
- **`label.adjustedY`** 계산 시 `Math.min(ay, svgH - 20, label.y + maxLabelDropFromNode)` 적용.
- 효과: “삼성생명”처럼 원(cy=100)에 대응하는 라벨이 **y=512까지 밀리지 않고**, 최대 **label.y + 120** 근처까지로 제한됨. 노드와 과도히 분리되는 현상 완화.

---

## 4. 요약

- **y=512**는 하드코딩/매직 넘버가 아니라, **겹침 회피 + viewport 하단 캡**으로 인한 **라벨–노드 분리** 현상.
- **대응**: 라벨 Y에 “노드에서 최대 Npx 아래” 상한을 두어, 좌표가 노드와 과도히 멀어지지 않도록 함. 숫자(120)는 Config로 빼서 의미를 명확히 함.
- 접근성·테스트·협업은 표에 맞춰 부분 반영 또는 후속 이슈로 정리.
