# QA 이슈 리스트: 그래프 시각화 (GraphIQ)

**검토 기준일**: 2025-02  
**대상**: `frontend/graph.js` / `graph.html` — 노드·엣지·라벨 레이아웃 및 렌더링

---

## P0 (Critical) — 라벨 심하게 겹침 / 화살표 가림

### QA-1. 레이아웃 후 스케일 단계에서 그래프를 축소해 간격이 무너짐
- **증상**: Force + overlap 해소로 노드 간격을 넓혀도, 직후 "bbox를 extent 90%로 채우기" 단계에서 `scale < 1`이면 전체가 축소되어 노드가 다시 가까워짐. 라벨은 픽셀 고정이라 겹침·화살표 가림 발생.
- **위치**: `graph.js` — `initPositions` 내 "공간 효율: 레이아웃 bbox를 extent의 90%를 채우도록 스케일" 블록.
- **원인**: `scale = Math.min(targetW/spanX, targetH/spanY, 4)` 에서 span이 크면 scale이 1 미만이 됨 → 레이아웃이 **압축**됨.
- **권장**: `scale`에 하한 1 적용 — 최소 `Math.max(1, scale)` 사용. 레이아웃이 만든 간격은 유지하고, 넓게 퍼진 경우에만 확대만 허용.

### QA-2. 물리적 크기가 “원만” 기준으로만 쓰일 수 있는 경로
- **증상**: `getLayoutRadius(node)`는 `node.label`이 있을 때만 라벨 반폭을 반영. API가 `label` 대신 `name` 등 다른 필드만 주면 항상 `base * 3`만 사용되어, 긴 라벨이 있어도 레이아웃은 작은 반지름으로 계산됨.
- **위치**: `graph.js` — `getLayoutRadius`, 및 노드 객체에 `label`이 설정되는 API/매핑.
- **권장**: 노드 표시 텍스트와 레이아웃에 쓰는 “라벨 길이”를 동일한 소스로 통일 (예: `node.label ?? node.name ?? ''`). API 스키마/매핑 문서화.

---

## P1 (High) — 레이아웃·라벨 정책

### QA-3. 레이아웃 반지름이 “세로(라벨 아래)”를 명시적으로 반영하지 않음
- **증상**: 현재는 가로만 `base + labelHalf`로 키움. 라벨은 노드 **아래**에 있으므로 세로로는 `nodeR + labelGap + labelHeight` 만큼 공간을 차지하는데, 이 값이 `getLayoutRadius`보다 클 수 있음 (짧은 라벨일 때).
- **위치**: `graph.js` — `getLayoutRadius` (세로 반영 없음), `LABEL_CONFIG.labelGap`, `labelHeight`.
- **권장**: 물리적 반지름을 “원+라벨 박스”를 감싸는 **직사각형의 반지름(반폭/반높이)** 로 정의하거나, 최소값으로 `nodeR + labelGap + labelHeight` 를 하한으로 사용해 세로도 반영.

### QA-4. 라벨 겹침 회피가 “렌더 단계 시프트”에만 의존
- **증상**: 레이아웃은 노드 중심만 배치하고, 라벨 위치는 `labelPositions` 순서대로 세로/가로 시프트로만 조정. 노드가 밀집해 있으면 여러 라벨이 아래로 쌓여 “한 덩어리”처럼 겹쳐 보임.
- **위치**: `graph.js` — "겹침 회피: 세로 우선, 가로 겹침 시 X 시프트" 블록.
- **권장**: 근본적으로는 QA-1, QA-2, QA-3으로 레이아웃 간격을 키우고, 라벨 시프트는 보조 수단으로만 사용. 필요 시 시프트 상한/클리핑으로 과도한 세로 누적 방지.

### QA-5. 노드 타입별 색상이 실제 노드에 구분되어 보이지 않음
- **증상**: UI 상 “노드 유형” 범례(회사/개인주주/최대주주/기관)는 색 점으로 구분되는데, 그래프 상 노드는 모두 흰 원 + 주황 테두리로만 보일 수 있음 (타입별 색 미적용 또는 미미함).
- **위치**: `graph.js` — 노드 원 `fill`/`stroke` 설정, `getNodeColor(n)` 사용 여부.
- **권장**: 타입별 색을 원 `fill` 또는 `stroke`에 명확히 반영하거나, 범례와 동일한 색 체계를 적용해 일관성 검증.

---

## P2 (Medium) — 동작·일관성

### QA-6. Fit View / 초기화 후에도 라벨이 잘리거나 화면 밖으로 나감
- **증상**: `fitToView`가 `getLayoutRadius(n)`로 bbox를 잡지만, 스케일 하한 미적용 시 여전히 좁은 영역에 그려질 수 있고, 라벨 `adjustedY`/`adjustedX` 클리핑이 뷰포트와 어긋날 수 있음.
- **권장**: QA-1 적용 후 재현 여부 확인. 뷰포트 변경 시 라벨 클리핑 경계가 `getGraphViewport()`와 일치하는지 검증.

### QA-7. 대량 노드 시 성능·가독성
- **증상**: 노드/엣지 수가 많을 때 레이아웃 반복·라벨 겹침 회피 루프가 무거울 수 있음. 노드 수 제한(예: 500)은 있으나, 그 안에서도 라벨 전부 표기 시 가독성 저하.
- **권장**: 노드 수 구간별(예: 50/200/500) 프레임/배치 시간 측정. 필요 시 라벨 표시 전략(줌 레벨/호버 시만 등) 검토.

---

## 요약

| 우선순위 | 이슈 | 한줄 요약 |
|----------|------|-----------|
| P0 | QA-1 | 스케일 축소로 레이아웃 간격이 무너져 라벨 겹침 → scale 하한 1 |
| P0 | QA-2 | `label` 미존재 시 라벨 반경 미반영 → 필드 통일/폴백 |
| P1 | QA-3 | 세로(라벨 아래) 반지름 미반영 → 하한에 labelGap+height 추가 |
| P1 | QA-4 | 라벨 겹침이 “시프트”에만 의존 → 레이아웃 강화가 주, 시프트는 보조 |
| P1 | QA-5 | 노드 타입별 색이 시각적으로 구분 안 됨 → fill/stroke 반영 |
| P2 | QA-6 | Fit View·클리핑과 뷰포트 일치 검증 |
| P2 | QA-7 | 대량 노드 시 성능·가독성 정책 |

**우선 조치 권장**: QA-1 (scale 하한 1) 적용 후 재현 테스트, 이어서 QA-2/QA-3 적용으로 물리적 크기 정의를 강화.
