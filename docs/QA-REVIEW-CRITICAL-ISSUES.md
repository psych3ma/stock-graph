# QA 전문가 검토 리포트: Critical Issues

**검토 일시**: 2026-02-17  
**검토 범위**: Vis.js 렌더링, 노드 클러스터링, UX 패턴 구현 상태  
**우선순위**: 🔴 Critical / 🟡 High / 🟢 Medium / 🔵 Low

---

## 🔴 Critical Issues (즉시 수정 필요)

### 1. 노드 필터링 로직 오류로 인한 그래프 비표시

**문제점**:
- `renderGraphWithVisJs()` 함수 내부에서 `connectedNodeIds`가 잘못 계산됨
- Line 1077: `connectedNodeIds`가 모든 엣지의 from/to를 포함하도록 잘못 초기화됨
- Line 1080-1082: 선택된 노드가 있을 때 연결된 노드만 필터링하여 대부분의 노드가 숨겨짐
- 이로 인해 이미지에서 보이는 것처럼 노드가 거의 보이지 않거나 클러스터링된 것처럼 보임

**영향도**:
- **심각도**: Critical
- **사용자 영향**: 그래프가 제대로 표시되지 않아 기능 사용 불가
- **재현 가능성**: 100% (선택된 노드가 있을 때 항상 발생)

**근본 원인**:
```javascript
// ❌ 잘못된 코드 (line 1077-1082)
const connectedNodeIds = new Set();
EDGES.forEach(e => { connectedNodeIds.add(e.from); connectedNodeIds.add(e.to); });
const visibleNodes = selectedNodeId 
  ? NODES.filter(n => activeFilters.has(n.type) && (n.id === selectedNodeId || connectedNodeIds.has(n.id)))
  : NODES.filter(n => activeFilters.has(n.type));
```

**문제 분석**:
1. `connectedNodeIds`가 모든 엣지의 양쪽 노드를 포함하므로 사실상 모든 노드가 포함됨
2. 하지만 선택된 노드가 있을 때 필터링 조건이 잘못되어 의도와 다르게 동작
3. 전역 변수 `connectedNodeIds`와 함수 내부 변수가 충돌

**수정 방안**:
```javascript
// ✅ 올바른 코드
// 전역 변수 connectedNodeIds는 setupVisNetworkEvents에서만 업데이트
// renderGraphWithVisJs에서는 전역 변수를 사용하되, 필터링은 하지 않음
const visibleNodes = NODES.filter(n => activeFilters.has(n.type));
// dimming 효과는 노드 렌더링 시 opacity로만 처리
```

---

### 2. 변수 스코프 충돌 및 상태 관리 오류

**문제점**:
- Line 1077: 함수 내부에서 `connectedNodeIds`를 재정의하여 전역 변수와 충돌
- `setupVisNetworkEvents()`에서 설정한 전역 `connectedNodeIds`가 무시됨
- 노드 선택 시 연결 노드 추적이 제대로 작동하지 않음

**영향도**:
- **심각도**: Critical
- **사용자 영향**: 노드 선택 시 dimming 효과가 작동하지 않음
- **재현 가능성**: 100%

**수정 방안**:
- 함수 내부에서 `connectedNodeIds` 변수명 변경 (예: `allConnectedNodeIds`)
- 또는 전역 변수를 직접 사용하도록 수정

---

## 🟡 High Priority Issues

### 3. 노드 클러스터링 문제 (레이아웃 품질)

**문제점**:
- 이미지에서 확인된 심각한 노드 클러스터링
- 노드들이 밀집되어 있어 가독성 저하
- 서버 사이드 레이아웃(PyGraphviz)이 제대로 적용되지 않았을 가능성

**가능한 원인**:
1. 서버 사이드 레이아웃 API 호출 실패 또는 타임아웃
2. 클라이언트 사이드 폴백 레이아웃의 파라미터 부적절
3. 초기 노드 배치 로직(`initPositions`)의 문제

**검증 필요 사항**:
- `/api/v1/graph/layout` API 응답 확인
- `positions` 객체의 값 분포 확인
- 브라우저 콘솔 에러 로그 확인

**수정 방안**:
1. 서버 사이드 레이아웃 실패 시 명확한 에러 메시지 표시
2. 클라이언트 사이드 폴백 레이아웃 파라미터 재조정
3. 노드 간 최소 거리(`minDist`) 증가

---

### 4. 범례 색상 불일치

**문제점**:
- 범례의 색상 스와치가 실제 노드 색상과 일치하지 않음
- 이미지에서 범례는 빨강/주황/보라 등 다양한 색상을 보여주지만, 실제 노드는 주로 주황색

**영향도**:
- **심각도**: High
- **사용자 영향**: 노드 타입 식별 혼란
- **재현 가능성**: 100%

**근본 원인**:
- CSS 변수(`--node-company`, `--node-person` 등)와 실제 `getNodeColor()` 함수의 색상 불일치
- 범례의 `.lc` 요소 스타일이 노드 색상과 동기화되지 않음

**수정 방안**:
- `getNodeColor()` 함수의 색상 값을 CSS 변수와 일치시키기
- 범례 색상을 JavaScript로 동적으로 설정

---

## 🟢 Medium Priority Issues

### 5. 노드 라벨 가독성 문제

**문제점**:
- 노드 클러스터링으로 인해 라벨이 겹쳐서 읽기 어려움
- 폰트 크기나 배경색이 충분하지 않을 수 있음

**수정 방안**:
- 라벨 배경색 불투명도 증가
- 폰트 크기 동적 조정 (노드 크기에 비례)
- 라벨 간 최소 거리 보장

---

### 6. 애니메이션 성능 최적화 필요

**문제점**:
- 대량의 노드(4,919개)에서 애니메이션이 성능 저하를 일으킬 수 있음
- `animation.enabled: true`가 모든 상태 변경에 적용됨

**수정 방안**:
- 노드 수가 일정 수준 이상일 때 애니메이션 비활성화
- 선택/해제 시에만 애니메이션 적용, 필터 변경 시에는 즉시 업데이트

---

## 🔵 Low Priority Issues

### 7. 툴팁 위치 최적화

**문제점**:
- 노드 클러스터링 시 툴팁이 다른 노드에 가려질 수 있음

**수정 방안**:
- 툴팁 위치를 마우스 커서 근처로 동적 조정
- z-index 증가

---

## 테스트 체크리스트

### 필수 테스트 항목

- [ ] **노드 필터링 테스트**
  - [ ] 필터 변경 시 모든 활성 필터 타입의 노드가 표시되는지 확인
  - [ ] 노드 선택 시 dimming 효과가 적용되는지 확인
  - [ ] 빈 공간 클릭 시 선택 해제 및 dimming 제거 확인

- [ ] **노드 클러스터링 테스트**
  - [ ] 서버 사이드 레이아웃이 제대로 적용되는지 확인
  - [ ] 노드 간 최소 거리가 유지되는지 확인
  - [ ] 라벨이 겹치지 않는지 확인

- [ ] **색상 일관성 테스트**
  - [ ] 범례 색상이 실제 노드 색상과 일치하는지 확인
  - [ ] 노드 타입별 색상이 올바르게 적용되는지 확인

- [ ] **성능 테스트**
  - [ ] 4,919개 노드 렌더링 시간 측정
  - [ ] 노드 선택/해제 시 애니메이션 부드러움 확인
  - [ ] 필터 변경 시 응답 시간 확인

---

## 권장 수정 순서

1. **즉시 수정** (Critical):
   - 노드 필터링 로직 수정 (Issue #1)
   - 변수 스코프 충돌 해결 (Issue #2)

2. **단기 수정** (High):
   - 범례 색상 일치 (Issue #4)
   - 노드 클러스터링 문제 조사 및 수정 (Issue #3)

3. **중기 개선** (Medium/Low):
   - 라벨 가독성 개선 (Issue #5)
   - 애니메이션 성능 최적화 (Issue #6)
   - 툴팁 위치 최적화 (Issue #7)

---

## 추가 조사 필요 사항

1. **서버 사이드 레이아웃 상태 확인**:
   - `/api/v1/graph/layout` 엔드포인트 응답 로그 확인
   - PyGraphviz 설치 및 동작 여부 확인
   - 레이아웃 계산 시간 측정

2. **브라우저 호환성**:
   - 다양한 브라우저에서 렌더링 테스트
   - Vis.js 라이브러리 로드 상태 확인

3. **데이터 품질**:
   - 노드/엣지 데이터의 무결성 확인
   - 중복 노드나 잘못된 관계 확인

---

**QA 검토자**: AI Assistant  
**다음 검토 예정일**: Critical Issues 수정 후
