# QA 검토: SVG 제거 및 Vis.js 단일 체제 전환 영향도 분석

## 검토 일자
2026-02-17

## 변경 사항 요약
- SVG 렌더링 코드 완전 제거 (~400줄)
- Vis.js 단일 렌더링 엔진으로 전환
- 줌 기능을 Vis.js Network API로 변경
- Vis.js 로드 대기 로직 추가

---

## 1. 기능 회귀 테스트 체크리스트

### ✅ 정상 동작 확인 필요 항목

| 기능 | 테스트 시나리오 | 우선순위 | 비고 |
|------|----------------|---------|------|
| **그래프 렌더링** | 페이지 로드 후 그래프가 표시되는지 | P0 | 필수 |
| **노드 클릭** | 노드 클릭 시 상세 패널 표시 | P0 | 필수 |
| **노드 드래그** | 노드 드래그로 위치 이동 | P1 | Vis.js 기본 기능 |
| **줌 인/아웃** | `+`, `-` 버튼으로 줌 조절 | P1 | Vis.js API 사용 |
| **전체보기** | `⊡` 버튼으로 fit-to-view | P1 | `visNetwork.fit()` |
| **노드 호버** | 마우스 오버 시 툴팁 표시 | P2 | `hoverNode` 이벤트 |
| **엣지 표시** | 관계(엣지)가 곡선으로 표시되는지 | P0 | 필수 |
| **엣지 라벨** | 엣지에 지분율(%) 표시 | P2 | 다중 엣지 번들링 |
| **필터** | 노드 타입 필터 동작 | P0 | 필수 |
| **검색** | 노드 검색 기능 | P1 | 검색 후 선택 |

### ⚠️ 잠재적 회귀 이슈

| 항목 | 위험도 | 설명 |
|------|--------|------|
| **노드 라벨 위치** | 중 | SVG에서는 하단 배치, Vis.js는 기본적으로 노드 내부/외부 자동 배치 |
| **엣지 라벨 가독성** | 중 | SVG에서는 배경색 처리, Vis.js는 `font.background` 사용 |
| **선택된 노드 강조** | 중 | SVG에서는 glow/ring 효과, Vis.js는 `highlight` 옵션 |
| **노드 크기** | 낮 | `NODE_RADIUS` 기반 크기 계산 유지 |

---

## 2. 브라우저 호환성

### Vis.js 지원 브라우저
- Chrome/Edge: ✅ (최신 버전)
- Firefox: ✅ (최신 버전)
- Safari: ✅ (최신 버전)
- IE11: ❌ (Vis.js는 IE11 미지원)

### CDN 의존성
- **위험**: `unpkg.com` CDN 사용 → 네트워크 실패 시 그래프 렌더링 불가
- **영향도**: 높음 (SVG 폴백 없음)
- **권장 조치**: 
  - 로컬 파일로 다운로드 후 배포
  - 또는 CDN 실패 시 명확한 에러 메시지

---

## 3. 에러 처리 및 폴백

### 현재 구현 상태

| 시나리오 | 처리 상태 | 문제점 |
|----------|-----------|--------|
| **Vis.js 로드 실패** | ✅ `waitForVisJs()` 타임아웃 후 에러 메시지 | 폴백 없음 (SVG 제거됨) |
| **Vis.js Network 생성 실패** | ✅ try-catch로 에러 메시지 | 재시도 로직 없음 |
| **컨테이너 요소 없음** | ✅ 에러 로그 후 return | 사용자 피드백 없음 |
| **positions 없음** | ✅ 경고 로그 후 return | 로딩 상태 유지 가능 |

### ⚠️ 발견된 이슈

#### 이슈 #1: 이벤트 리스너 중복 등록
**위치**: `renderGraphWithVisJs()` (1059-1077줄)

**문제**:
- `visNetwork`가 이미 존재할 때 `setData()`/`setOptions()`만 호출
- 하지만 `renderGraphWithVisJs()`가 여러 번 호출되면 이벤트 리스너가 중복 등록될 수 있음

**영향도**: 중간 (메모리 누수, 이벤트 중복 실행)

**권장 수정**:
```javascript
if (visNetwork) {
  visNetwork.setData(data);
  visNetwork.setOptions(options);
} else {
  visNetwork = new vis.Network(container, data, options);
  // 이벤트 리스너는 한 번만 등록
  setupVisNetworkEvents(visNetwork);
}
```

#### 이슈 #2: visNetwork null 체크 부족
**위치**: 줌 버튼 핸들러 (1106, 1115, 1124, 1133줄)

**문제**:
- `visNetwork`가 null일 때 조용히 실패 (사용자 피드백 없음)
- 초기 렌더링 전에 줌 버튼 클릭 시 동작 안 함

**영향도**: 낮음 (UX 저하)

**권장 수정**:
```javascript
if (visNetwork) {
  // ...
} else {
  console.warn('Graph not initialized yet');
  // 또는 버튼 비활성화
}
```

#### 이슈 #3: 컨테이너 크기 초기화
**위치**: `renderGraphWithVisJs()` (1000줄)

**문제**:
- CSS `100%`만 사용 시 초기 렌더링 시 컨테이너 크기가 0일 수 있음
- `getGraphViewport()`로 크기를 가져오지만 실제로 컨테이너에 적용하지 않음

**영향도**: 중간 (초기 렌더링 실패 가능)

**권장 수정**:
```javascript
const { width: vpW, height: vpH } = getGraphViewport();
// 컨테이너 크기 명시적 설정 (초기 렌더링 보장)
if (container.offsetWidth === 0 || container.offsetHeight === 0) {
  container.style.width = vpW + 'px';
  container.style.height = vpH + 'px';
}
```

#### 이슈 #4: Vis.js 인스턴스 정리 없음
**위치**: `renderGraphWithVisJs()` (1059줄)

**문제**:
- `visNetwork`가 이미 존재할 때 이전 인스턴스를 정리하지 않음
- `destroy()` 호출 없음 → 메모리 누수 가능

**영향도**: 낮음 (장기 실행 시 누적)

**권장 수정**:
```javascript
if (visNetwork) {
  visNetwork.destroy(); // 이전 인스턴스 정리
}
visNetwork = new vis.Network(container, data, options);
```

#### 이슈 #5: resize 이벤트 처리
**위치**: `window.addEventListener('resize')` (1595줄)

**문제**:
- 컨테이너 크기 변경 시 Vis.js가 자동으로 처리하지만, `initPositions()` 재실행으로 인한 불필요한 연산
- Vis.js는 `redraw()` 또는 자동 리사이즈 지원

**영향도**: 낮음 (성능)

**권장 수정**:
```javascript
window.addEventListener('resize', () => {
  if (visNetwork) {
    visNetwork.redraw(); // Vis.js 자동 리사이즈
  }
});
```

---

## 4. 성능 영향

### 개선 사항
- ✅ 코드량 감소 (~400줄) → 번들 크기 감소
- ✅ SVG DOM 조작 제거 → 렌더링 성능 향상
- ✅ Vis.js 내부 최적화 활용

### 잠재적 성능 이슈
- ⚠️ Vis.js 라이브러리 크기 (~200KB) → 초기 로드 시간 증가
- ⚠️ CDN 의존성 → 네트워크 지연 가능
- ⚠️ 대량 노드(500+) 렌더링 시 Vis.js 성능 (현재 `physics: false`로 완화)

---

## 5. 사용자 경험 변화

### 개선 사항
- ✅ 부드러운 엣지 곡선 (`smooth: continuous`)
- ✅ 라벨 배경으로 가독성 향상
- ✅ 기본 줌/드래그 인터랙션

### 잠재적 UX 이슈
- ⚠️ Vis.js 로드 실패 시 완전한 기능 불가 (SVG 폴백 없음)
- ⚠️ 초기 로드 시간 증가 (CDN 의존)
- ⚠️ 노드 라벨 위치가 SVG와 다를 수 있음

---

## 6. 에지 케이스 테스트

### 필수 테스트 시나리오

| 시나리오 | 테스트 방법 | 예상 결과 |
|----------|------------|-----------|
| **Vis.js CDN 실패** | 네트워크 탭에서 CDN 차단 | 에러 메시지 표시, 그래프 미표시 |
| **빈 그래프** | 노드 0개 상태 | 빈 화면 또는 안내 메시지 |
| **대량 노드** | 500+ 노드 로드 | 성능 저하 없이 렌더링 |
| **빠른 연속 클릭** | 줌 버튼 빠르게 클릭 | 모든 클릭 반영 |
| **창 크기 변경** | 브라우저 창 리사이즈 | 그래프 자동 조정 |
| **탭 전환 후 복귀** | 다른 탭으로 이동 후 복귀 | 그래프 상태 유지 |

---

## 7. 권장 수정 사항 (우선순위)

### P0 (즉시 수정)
1. **이벤트 리스너 중복 등록 방지**
   - `setupVisNetworkEvents()` 함수 분리
   - 한 번만 등록되도록 플래그 추가

2. **컨테이너 크기 초기화 보장**
   - 초기 렌더링 시 명시적 크기 설정

### P1 (다음 릴리스)
3. **Vis.js 인스턴스 정리**
   - `destroy()` 호출 추가

4. **에러 복구 로직**
   - Vis.js 생성 실패 시 재시도 (최대 3회)

5. **CDN 폴백**
   - 로컬 파일로 다운로드 후 배포
   - 또는 CDN 실패 시 명확한 안내

### P2 (향후 개선)
6. **resize 이벤트 최적화**
   - 불필요한 `initPositions()` 제거

7. **줌 버튼 상태 관리**
   - `visNetwork` 없을 때 버튼 비활성화

---

## 8. 테스트 체크리스트

### 기능 테스트
- [ ] 페이지 로드 후 그래프 표시
- [ ] 노드 클릭 → 상세 패널 표시
- [ ] 노드 드래그 → 위치 이동
- [ ] 줌 인/아웃 버튼 동작
- [ ] 전체보기 버튼 동작
- [ ] 노드 호버 → 툴팁 표시
- [ ] 엣지 표시 및 라벨
- [ ] 필터 동작
- [ ] 검색 기능

### 에러 테스트
- [ ] Vis.js CDN 실패 시나리오
- [ ] 빈 그래프 처리
- [ ] 네트워크 오류 처리
- [ ] 백엔드 연결 실패 처리

### 성능 테스트
- [ ] 대량 노드(500+) 렌더링 시간
- [ ] 메모리 사용량 (장기 실행)
- [ ] 초기 로드 시간

### 브라우저 테스트
- [ ] Chrome (최신)
- [ ] Firefox (최신)
- [ ] Safari (최신)
- [ ] Edge (최신)

---

## 9. 결론 및 권장사항

### 전반적 평가
- ✅ **코드 단순화**: SVG 제거로 유지보수성 향상
- ✅ **기능 유지**: 핵심 기능은 Vis.js로 대체 가능
- ⚠️ **폴백 부재**: Vis.js 실패 시 완전한 기능 불가
- ⚠️ **CDN 의존성**: 네트워크 실패 시 영향 큼

### 즉시 조치 필요
1. 이벤트 리스너 중복 등록 방지
2. 컨테이너 크기 초기화 보장
3. Vis.js 로드 실패 시 명확한 사용자 안내

### 장기 개선
1. Vis.js 로컬 파일로 배포 (CDN 의존성 제거)
2. 에러 복구 로직 강화
3. 성능 모니터링 추가

---

**QA 검토자**: AI Assistant  
**검토 완료일**: 2026-02-17
