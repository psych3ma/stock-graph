/* ═══════════════════════════════════════════════════════════════════════════
   DESIGN TOKENS (확장/테마 시 :root 만 수정)
   - 색상: 시맨틱(--text-1, --border) + 브랜드(--pwc-orange) + 컴포넌트(--edge-stroke)
   - 간격: --space-* 스케일 권장 (필요 시 추가)
   - 폰트/radius: --sans, --mono, --r
══════════════════════════════════════════════════════════════════════════ */
:root {
  --bg:         #f9f7f5;
  --surface:    #ffffff;
  --surface-2:  #f4f1ee;
  --border:     #e8e2db;
  --border-2:   #d6cfc6;

  --pwc-red:    #ad1b02;
  --pwc-orange: #d85604;
  --pwc-amber:  #e88d14;
  --pwc-yellow: #f3be26;
  --pwc-pink:   #e669a2;
  --pwc-black:  #1a1008;

  --text-1:     #1a1008;
  --text-2:     #6b5c48;
  --text-3:     #a8998a;
  --text-4:     #c9bdb2;

  --node-company:     #d85604;
  --node-person:      #ad1b02;
  --node-major:       #e88d14;
  --node-institution: #7c5cfc;

  /* 그래프/SVG용 (JS setAttribute 시 동일 이름 사용 권장) */
  --edge-stroke:       #8b7d6f;
  --edge-stroke-active: var(--pwc-orange);
  --surface-tint:      #fff4ed;
  --surface-tint-strong: #fff8f0;
  --border-tint:       #fbc99a;
  --accent-alpha-08:  rgba(216,86,4,.08);
  --accent-alpha-06:  rgba(216,86,4,.06);
  --accent-alpha-12:  rgba(216,86,4,.12);
  --accent-alpha-20:  rgba(216,86,4,.2);
  --accent-alpha-25:  rgba(216,86,4,.25);
  --accent-alpha-40:  rgba(216,86,4,.4);
  --status-ok:        #22c97a;
  --surface-overlay:  rgba(249,247,245,.9);

  --sans: 'Geist', 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
  --mono: 'Geist Mono', 'JetBrains Mono', monospace;

  --panel-w: 360px;
  --top-h:   48px;
  --r:       8px;
  --r-lg:    12px;
  --r-xl:    18px;

  /* 간격 스케일 (확장/일관성: padding, gap, margin에 사용) */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;

  /* 시맨틱 보조 색 (경고/에러 배지 등, 하드코딩 제거) */
  --surface-warning: #fffbf0;
  --border-warning:  #f5d896;
  --surface-error:   #fff0f0;
  --border-error:    #f5b7b7;

  --shadow-sm: 0 1px 3px rgba(0,0,0,.08), 0 0 0 1px rgba(0,0,0,.04);
  --shadow-md: 0 4px 16px rgba(0,0,0,.1), 0 1px 4px rgba(0,0,0,.06);
  --shadow-lg: 0 12px 40px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.06);
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{
  font-family:var(--sans);
  background:var(--bg);
  color:var(--text-1);
  -webkit-font-smoothing:antialiased;
  display:flex;flex-direction:column;
}
button{font-family:inherit;cursor:pointer;border:none;background:none}
input,textarea{font-family:inherit}

/* ── TOP BAR ─────────────────────────────── */
.topbar{
  height:var(--top-h);flex-shrink:0;
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 16px;gap:12px;
  box-shadow:0 1px 0 var(--border);
  z-index:100;
}
.logo{display:flex;align-items:center;gap:7px;user-select:none;margin-right:4px}
.logo-mark{
  width:26px;height:26px;
  background:linear-gradient(135deg,var(--pwc-red),var(--pwc-orange));
  border-radius:7px;display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.logo-name{font-size:15px;font-weight:700;color:var(--pwc-black);letter-spacing:-.4px}
.topbar-sep{width:1px;height:20px;background:var(--border);flex-shrink:0}

/* search bar */
.search-wrap{
  flex:1;max-width:360px;
  display:flex;align-items:center;gap:8px;
  background:var(--surface-2);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:0 12px;height:32px;
  transition:all .15s;
}
.search-wrap:focus-within{
  background:var(--surface);
  border-color:var(--pwc-orange);
  box-shadow:0 0 0 3px var(--accent-alpha-08);
}
.search-wrap svg{color:var(--text-3);flex-shrink:0}
.search-input{
  flex:1;border:none;outline:none;background:transparent;
  font-size:13px;color:var(--text-1);
}
.search-input::placeholder{color:var(--text-4)}

/* filter pills */
.filter-group{display:flex;gap:var(--space-1);align-items:center}
.filter-group-label{font-size:11px;color:var(--text-3)}
.filter-pill{
  display:flex;align-items:center;gap:5px;
  padding:4px 10px;border-radius:20px;
  font-size:11.5px;font-weight:500;
  background:var(--surface-2);border:1px solid var(--border);
  color:var(--text-2);transition:all .12s;cursor:pointer;
  white-space:nowrap;
}
.filter-pill:hover{border-color:var(--border-2);background:var(--surface)}
.filter-pill.active{background:var(--surface-tint);border-color:var(--border-tint);color:var(--pwc-orange)}
.filter-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.filter-pill[data-filter="company"] .filter-dot{background:var(--node-company)}
.filter-pill[data-filter="person"] .filter-dot{background:var(--node-person)}
.filter-pill[data-filter="major"] .filter-dot{background:var(--node-major)}
.filter-pill[data-filter="institution"] .filter-dot{background:var(--node-institution)}
.filter-label{font-weight:500}

.topbar-right{margin-left:auto;display:flex;gap:6px;align-items:center}
.tb-btn{
  height:30px;padding:0 10px;border-radius:var(--r);
  font-size:12px;font-weight:500;color:var(--text-2);
  border:1px solid var(--border);background:var(--surface);
  display:flex;align-items:center;gap:5px;transition:all .15s;
}
.tb-btn:hover{border-color:var(--border-2);color:var(--text-1)}

/* status */
.status-dot{
  display:flex;align-items:center;gap:5px;
  font-size:11.5px;font-family:var(--mono);color:var(--text-3);
}
.sdot{
  width:6px;height:6px;border-radius:50%;
  background:var(--status-ok);animation:blink 2.5s ease-in-out infinite;
}
.sdot.error{background:var(--pwc-orange);animation:none}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* ── MAIN LAYOUT ─────────────────────────── */
.main{flex:1;display:flex;overflow:hidden;position:relative}

/* ── GRAPH CANVAS ────────────────────────── */
.graph-area{
  flex:1;position:relative;overflow:hidden;
  background:var(--bg);
  background-image:
    radial-gradient(circle at 30% 40%, var(--accent-alpha-06) 0%, transparent 55%),
    radial-gradient(circle at 75% 70%, rgba(173,27,2,.03) 0%, transparent 50%);
}

.graph-area::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background-image:
    linear-gradient(var(--border) 1px,transparent 1px),
    linear-gradient(90deg,var(--border) 1px,transparent 1px);
  background-size:40px 40px;
  opacity:.4;
}

#graphSvg{width:100%;height:100%;cursor:grab;display:block}
#graphSvg:active{cursor:grabbing}

/* 로딩 중 그래프 영역 오버레이 (빈 화면 방지) */
.graph-loading-overlay{
  position:absolute;inset:0;z-index:40;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:rgba(249,247,245,.85);pointer-events:none;
}
.graph-loading-overlay.hidden{display:none}
.graph-loading-spinner{
  width:40px;height:40px;border:3px solid var(--border);
  border-top-color:var(--pwc-orange);border-radius:50%;
  animation:graph-load-spin .8s linear infinite;
}
@keyframes graph-load-spin{to{transform:rotate(360deg)}}
.graph-loading-step{font-size:14px;font-weight:500;color:var(--text-2);margin-top:14px;}
.graph-loading-hint{font-size:12px;color:var(--text-3);margin-top:6px;}

.node-tooltip{
  position:absolute;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:8px 12px;
  font-size:12px;
  color:var(--text-1);
  pointer-events:none;
  box-shadow:var(--shadow-md);
  max-width:200px;
  z-index:50;
  display:none;
}
.node-tooltip strong{display:block;font-weight:600;margin-bottom:2px}
.node-tooltip span{color:var(--text-2);font-size:11px}

.zoom-controls{
  position:absolute;bottom:20px;left:20px;
  display:flex;flex-direction:column;gap:4px;z-index:50;
}
.zoom-btn{
  width:32px;height:32px;
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--r);display:flex;align-items:center;justify-content:center;
  font-size:16px;color:var(--text-2);
  box-shadow:var(--shadow-sm);transition:all .15s;
  cursor:pointer;
}
.zoom-btn:hover{border-color:var(--border-2);color:var(--text-1)}
.zoom-btn--icon{font-size:11px}

.util-hidden{display:none !important}

.graph-legend{
  position:absolute;bottom:20px;right:20px;
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(8px);
  border:1px solid var(--border);
  border-radius:var(--r-lg);
  padding:12px 14px;
  box-shadow:var(--shadow-sm);
  z-index:50;
}
.legend-title{font-size:10px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;color:var(--text-3);margin-bottom:8px}
.legend-row{display:flex;align-items:center;gap:7px;font-size:11.5px;color:var(--text-2);margin-bottom:5px}
.legend-row:last-child{margin-bottom:0}
.legend-row[data-count-type="company"] .lc{background:var(--node-company)}
.legend-row[data-count-type="person"] .lc{background:var(--node-person)}
.legend-row[data-count-type="major"] .lc{background:var(--node-major)}
.legend-row[data-count-type="institution"] .lc{background:var(--node-institution)}
.legend-label{flex:1;min-width:0}
.legend-count{
  font-size:10px;color:var(--text-3);font-weight:500;margin-left:auto;
  min-width:4.8em;text-align:right;flex-shrink:0;
}
.lc{width:9px;height:9px;border-radius:50%;flex-shrink:0}

/* ── RIGHT PANEL ─────────────────────────── */
.side-panel{
  width:var(--panel-w);flex-shrink:0;
  background:var(--surface);
  border-left:1px solid var(--border);
  display:flex;flex-direction:column;
  overflow:hidden;
  transition:width .25s cubic-bezier(.4,0,.2,1);
}
.side-panel.collapsed{width:0;overflow:hidden}

.panel-tabs{
  display:flex;border-bottom:1px solid var(--border);flex-shrink:0;
}
.ptab{
  flex:1;padding:11px 8px;
  font-size:12px;font-weight:500;color:var(--text-3);
  border-bottom:2px solid transparent;transition:all .15s;
  text-align:center;cursor:pointer;
}
.ptab.active{color:var(--pwc-orange);border-bottom-color:var(--pwc-orange)}
.ptab:hover:not(.active){color:var(--text-2)}

.panel-body{flex:1;overflow:hidden;display:flex;flex-direction:column}

.panel-empty{
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:32px 24px;text-align:center;
  color:var(--text-3);gap:12px;
}
.panel-empty svg{opacity:.3}
.panel-empty p{font-size:13px;line-height:1.6}
.panel-empty span{font-size:11.5px;color:var(--text-4)}

.node-detail{flex:1;overflow-y:auto;display:none;flex-direction:column}
.node-detail.visible{display:flex}
.node-detail::-webkit-scrollbar{width:4px}
.node-detail::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

.nd-header{
  padding:20px 20px 16px;
  border-bottom:1px solid var(--border);
  flex-shrink:0;
}
.nd-type-row{display:flex;align-items:center;gap:6px;margin-bottom:8px}
.nd-type-badge{
  display:inline-flex;align-items:center;gap:4px;
  padding:3px 8px;border-radius:20px;
  font-size:10.5px;font-weight:600;font-family:var(--mono);
}
.nd-name{
  font-size:18px;font-weight:700;color:var(--text-1);
  letter-spacing:-.4px;line-height:1.2;margin-bottom:4px;
}
.nd-sub{font-size:12px;color:var(--text-3)}

.nd-stats{
  display:grid;grid-template-columns:1fr 1fr;gap:1px;
  background:var(--border);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);
  flex-shrink:0;
}
.nd-stat{
  background:var(--surface);padding:12px 16px;
  text-align:center;
}
.nd-stat-val{font-size:20px;font-weight:700;color:var(--text-1);letter-spacing:-.5px}
.nd-stat-key{font-size:10px;color:var(--text-3);margin-top:2px;font-family:var(--mono)}

.nd-section{padding:16px 20px;border-bottom:1px solid var(--border)}
.nd-section:last-child{border-bottom:none}
.nd-section-title{
  font-size:10px;font-weight:600;letter-spacing:1px;
  text-transform:uppercase;color:var(--text-3);margin-bottom:10px;
}

.related-list{display:flex;flex-direction:column;gap:4px}
.related-item{
  display:flex;align-items:center;gap:9px;
  padding:8px 10px;
  border:1px solid var(--border);border-radius:var(--r);
  cursor:pointer;transition:all .12s;background:var(--surface);
}
.related-item:hover{border-color:var(--border-2);background:var(--surface-2)}
.related-item.active{border-color:var(--pwc-orange);background:var(--surface-tint-strong)}
.ri-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.ri-name{font-size:13px;font-weight:500;color:var(--text-1);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ri-meta{font-size:11px;color:var(--text-3);flex-shrink:0}
.ri-val{
  font-size:11px;font-weight:600;font-family:var(--mono);
  padding:2px 7px;border-radius:20px;flex-shrink:0;
  background:var(--surface-tint);color:var(--pwc-orange);
}

.props-grid{display:flex;flex-direction:column;gap:6px}
.prop-row{
  display:flex;align-items:baseline;justify-content:space-between;gap:8px;
}
.prop-key{font-size:11.5px;color:var(--text-3);flex-shrink:0}
.prop-val{font-size:12px;font-family:var(--mono);color:var(--text-1);text-align:right;word-break:break-all}

.ask-context-btn{
  margin:0 16px 16px;
  display:flex;align-items:center;gap:6px;justify-content:center;
  padding:9px;border-radius:var(--r);
  background:linear-gradient(135deg,var(--pwc-red),var(--pwc-orange));
  color:#fff;font-size:13px;font-weight:600;
  transition:all .15s;box-shadow:0 2px 8px var(--accent-alpha-25);
  cursor:pointer;border:none;width:calc(100% - 32px);
}
.ask-context-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 4px 14px var(--accent-alpha-25);
}
.ego-banner{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 16px;background:linear-gradient(135deg,var(--surface-tint-strong),var(--surface-tint));
  border-bottom:1px solid var(--accent-alpha-20);font-size:12px;
}
.ego-banner-label{font-weight:600;color:var(--pwc-orange)}
.ego-exit-btn{
  padding:6px 10px;border-radius:var(--r);border:1px solid var(--pwc-orange);
  background:var(--surface);color:var(--pwc-orange);font-size:11px;font-weight:600;
  cursor:pointer;transition:all .15s;
}
.ego-exit-btn:hover{background:var(--surface-tint)}
.ego-map-btn{
  margin:0 16px 10px;
  display:flex;align-items:center;gap:6px;justify-content:center;
  padding:9px;border-radius:var(--r);
  background:var(--surface);color:var(--pwc-orange);border:1px solid var(--accent-alpha-40);
  font-size:12px;font-weight:600;cursor:pointer;width:calc(100% - 32px);
  transition:all .15s;
}
.ego-map-btn:hover{background:var(--surface-tint-strong);border-color:var(--pwc-orange)}

/* ── CHAT SECTION ── */
.chat-section{
  flex:1;display:flex;flex-direction:column;overflow:hidden;
}
.chat-section.visible{display:flex}

.chat-context-bar{
  padding:8px 14px;
  background:var(--accent-alpha-06);
  border-bottom:1px solid var(--accent-alpha-12);
  display:flex;align-items:center;gap:7px;
  flex-shrink:0;
}
.ctx-label{font-size:11px;font-weight:500;color:var(--pwc-orange)}
.ctx-chip{
  font-size:11px;font-family:var(--mono);
  background:var(--accent-alpha-06);
  border:1px solid var(--accent-alpha-20);
  color:var(--pwc-red);
  padding:2px 8px;border-radius:20px;
}
.ctx-clear{margin-left:auto;font-size:11px;color:var(--text-3);cursor:pointer}
.ctx-clear:hover{color:var(--text-1)}

.chat-msgs{
  flex:1;overflow-y:auto;
  padding:14px 16px;
  display:flex;flex-direction:column;gap:10px;
}
.chat-msgs::-webkit-scrollbar{width:3px}
.chat-msgs::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

.suggestions{display:flex;flex-direction:column;gap:5px;margin-top:4px}
.sug-item{
  padding:8px 12px;border-radius:var(--r);
  background:var(--surface-2);border:1px solid var(--border);
  font-size:12.5px;color:var(--text-2);cursor:pointer;
  transition:all .12s;text-align:left;
  display:flex;align-items:flex-start;gap:6px;
}
.sug-item::before{content:'↗';font-size:11px;color:var(--text-4);flex-shrink:0;margin-top:1px}
.sug-item:hover{background:var(--surface);border-color:var(--border-2);color:var(--text-1)}
.sug-item:hover::before{color:var(--pwc-orange)}

.msg{display:flex;flex-direction:column;gap:2px;max-width:100%}
.msg.user{align-items:flex-end}
.msg.ai{align-items:flex-start}

.msg-bubble{
  padding:9px 13px;border-radius:var(--r-lg);
  font-size:13px;line-height:1.65;max-width:90%;
}
.msg.user .msg-bubble{
  background:var(--pwc-black);color:#fff;
  border-bottom-right-radius:4px;
}
.msg.ai .msg-bubble{
  background:var(--surface-2);color:var(--text-1);
  border:1px solid var(--border);
  border-bottom-left-radius:4px;
}
.msg-meta{
  font-size:10.5px;color:var(--text-4);
  font-family:var(--mono);padding:0 4px;
}
.src-tag{
  display:inline-flex;align-items:center;gap:3px;
  font-size:10px;font-weight:600;font-family:var(--mono);
  padding:1px 6px;border-radius:20px;margin-top:4px;
}
.src-db{
  background:var(--surface-tint);color:var(--pwc-orange);border:1px solid var(--border-tint);
}
.src-db-empty{
  background:var(--surface-warning);color:#b8860b;border:1px solid var(--border-warning);
}
.src-llm{
  background:var(--surface-error);color:var(--pwc-orange);border:1px solid var(--border-error);
}

.typing-bubble{
  padding:10px 14px;border-radius:var(--r-lg);
  background:var(--surface-2);border:1px solid var(--border);
  border-bottom-left-radius:4px;
  display:flex;align-items:center;gap:5px;
}
.typing-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--text-4);animation:typingBounce 1.2s ease-in-out infinite;
}
.typing-dot:nth-child(2){animation-delay:.15s}
.typing-dot:nth-child(3){animation-delay:.3s}
@keyframes typingBounce{0%,80%,100%{background:var(--border-2)}40%{background:var(--pwc-orange)}}

.chat-input-area{
  padding:10px 12px 12px;
  border-top:1px solid var(--border);flex-shrink:0;
  background:var(--surface);
}
.chat-input-wrap{
  display:flex;gap:7px;align-items:flex-end;
  background:var(--surface-2);border:1.5px solid var(--border);
  border-radius:var(--r-lg);padding:8px 8px 8px 12px;
  transition:all .15s;
}
.chat-input-wrap:focus-within{
  background:var(--surface);border-color:var(--pwc-orange);
  box-shadow:0 0 0 3px var(--accent-alpha-08);
}
.chat-textarea{
  flex:1;border:none;outline:none;background:transparent;
  font-size:13px;color:var(--text-1);resize:none;
  max-height:80px;line-height:1.5;
}
.chat-textarea::placeholder{color:var(--text-4)}
.chat-send{
  width:30px;height:30px;border-radius:var(--r);
  background:var(--pwc-orange);color:#fff;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;transition:all .15s;cursor:pointer;
}
.chat-send:hover{background:var(--pwc-red)}
.chat-send:disabled{background:var(--border);cursor:not-allowed}

.panel-toggle-btn{
  position:absolute;left:-20px;top:50%;transform:translateY(-50%);
  width:20px;height:56px;
  background:var(--surface);border:1px solid var(--border);
  border-right:none;border-radius:6px 0 0 6px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;z-index:60;
  color:var(--text-3);transition:all .15s;
  box-shadow:var(--shadow-sm);
}
.panel-toggle-btn:hover{background:var(--surface-2);color:var(--text-1)}

@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.anim{animation:fadeUp .25s ease both}
